<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template-->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="../bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/wwn.css">
</head>
<body>


<div class="container-fluid main">
    <div class="card">
        <div class="card-header">

            <i class="fa fa-table"></i>用户管理
        </div>
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active">
                <a href="#users" aria-controls="home" role="tab" data-toggle="tab">
                    用户
                </a>
            </li>
            <li role="presentation">
                <a href="#jurisdiction" role="tab" data-toggle="tab">
                    权限
                </a>
            </li>
            <li role="presentation">
                <a href="#role" role="tab" data-toggle="tab">
                    角色
                </a>
            </li>
        </ul>
        <div class="card-body" id="users">
            <div>
                <div class="bcard-header">
                    <div>
                        <button class="btn btn-default add" data-toggle="modal" data-target=".adduser">增加
                        </button>
                        <button class="btn btn-default del">删除
                        </button>
                        <button class="btn btn-default upd" data-toggle="modal" data-target=".upduser">修改
                        </button>
                        <button class="btn btn-default find" data-toggle="modal" data-target=".finduser">查询
                        </button>
                    </div>
                    <div class="right">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <select class='form-control' name="">
                            <option value="">123</option>
                            <option value="">123</option>
                            <option value="">123</option>
                        </select>
                        <button class="btn btn-default">筛选</button>
                    </div>
                </div>
                <div class="bcard-body">
                    <table class="table table-bordered table-hover table-striped">
                    </table>
                </div>
            </div>
            <div class="bcard-foot">

            </div>
        </div>
        <div class="card-body" id="jurisdiction" style="display:none">
            <div>
                <div class="bcard-header">
                    <div>
                        <button class="btn btn-default">增加</button>
                        <button class="btn btn-default">删除</button>
                        <button class="btn btn-default">修改</button>
                        <button class="btn btn-default">查询</button>
                    </div>
                    <div class="right">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <select class='form-control' name="" id="">
                            <option value="">123</option>
                            <option value="">123</option>
                            <option value="">123</option>
                        </select>
                        <button class="btn btn-default">筛选</button>

                    </div>
                </div>

                <div class="bcard-body">
                    <table class="table table-bordered table-hover table-striped">
                        <tr>
                            <th>
                                1
                            </th>
                            <th>2</th>
                            <th>3</th>
                            <th>4</th>
                            <th>5</th>
                            <th>6</th>
                            <th>7</th>
                            <th>8</th>
                            <th>9</th>
                            <th>10</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>

                    </table>
                </div>
            </div>
            <div class="bcard-body">
                <div>没有符合条件的记录</div>
                <ul class="pagination">
                    <li>
                        <a href="#" aria-label="Previous">
                            <span aria-hidden="true">上一页</span>
                        </a>
                    </li>
                    <li><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li>
                        <a href="#" aria-label="Next">
                            <span aria-hidden="true">下一页</span>
                        </a>
                    </li>
                </ul>

            </div>
        </div>
        <div class="card-body" id="role" style="display:none">
            <h1>role</h1>
            <div>
                <div class="bcard-header">
                    <div>
                        <button class="btn btn-default">增加</button>
                        <button class="btn btn-default">删除</button>
                        <button class="btn btn-default">修改</button>
                        <button class="btn btn-default">查询</button>
                    </div>
                    <div class="right">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <input class='form-control' type="text">
                        <span>啦啦</span>
                        <select class='form-control' name="">
                            <option value="">123</option>
                            <option value="">123</option>
                            <option value="">123</option>
                        </select>
                        <button class="btn btn-default">筛选</button>

                    </div>
                </div>

                <div class="bcard-body">
                    <table class="table table-bordered table-hover table-striped">
                        <tr>
                            <th>
                                1
                            </th>
                            <th>2</th>
                            <th>3</th>
                            <th>4</th>
                            <th>5</th>
                            <th>6</th>
                            <th>7</th>
                            <th>8</th>
                            <th>9</th>
                            <th>10</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                            <td>5</td>
                            <td>6</td>
                            <td>7</td>
                            <td>8</td>
                            <td>9</td>
                            <td>10</td>
                        </tr>

                    </table>
                </div>
            </div>
            <div class="bcard-foot">
                <div>没有符合条件的记录</div>
                <ul class="pagination">
                    <li>
                        <a href="#" aria-label="Previous">
                            <span aria-hidden="true">上一页</span>
                        </a>
                    </li>
                    <li><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li>
                        <a href="#" aria-label="Next">
                            <span aria-hidden="true">下一页</span>
                        </a>
                    </li>
                </ul>

            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-sm adduser" tabindex="-1" role="dialog" aria-labelledby="adduser">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">详细信息</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group f1">
                        <label for="vname">昵称:</label>
                        <input type="text" class="form-control" id="vname" placeholder="">
                    </div>
                    <div class="form-group f1">
                        <label for="phone">手机号:</label>
                        <input type="text" class="form-control" id="phone" placeholder="">
                    </div>
                    <div class="form-group f1">
                        <label for="pwd">密码:</label>
                        <input type="password" class="form-control" id="pwd" placeholder="">
                    </div>
                    <div class="form-group f1">
                        <label for="pwd">角色:</label>
                        <select name="" id="tRole_id" class="select">
                            <option value=""></option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="t6">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

<script src="../vendor/jquery/jquery.js"></script>
<script src="../bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>


<script>
    $(document).ready(function () {
        init()
    })

    $('.table')
    //初始化请求
    var user = {
        el: 'users',
        page: 1,
        url: 'http://127.0.0.1:8000/v1/users/user',
    }
    var role = {
        el: 'users',
        page: 1,
        url: 'http://127.0.0.1:8000/v1/users/role',
    }
    var right = {
        el: 'right',
        page: 1,
        url: 'http://127.0.0.1:8000/v1/users/right',
    }
    temp = user
    var init = function () {
        click_hanlde()
        get_lists(temp)
    }
    //获取列表
    var get_lists = function (obj) {
        $.ajax({
            url: obj.url + '?page=' + obj.page,
            type: 'get',
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            // data: JSON.stringify({'id': arr}),
            success: function (req) {
                if (req.code == '200') {
                    create_table(req, obj)
                    create_page(req, obj)
                } else {
                    alert(req.error)
                }
            },
            error: function (q, w, e) {
                console.log(q, w, e)
            }
        })
    }
    //创建表格
    var create_table = function (req, obj) {
        arr = [`<tr>
                            <th> </th>
                            <th>编号</th>
                            <th>昵称</th>
                            <th>登录名称</th>
                            <th>密码</th>
                            <th>角色</th>
                            <th>登录次数</th>
                            <th>创建时间</th>
                        </tr>`]
        if (req.data.length == 0) {
            arr.push(`<tr><td colspan="6">暂无数据... </td></tr>`)
        } else {
            console.log(req.data)

            for (var i = 0; i < req.data.length; i++) {
                arr.push(`<tr>
                            <td><input type="checkbox" name="favorite" value="${req.data[i].id}" /></td>
                            <td>${req.data[i].id}</td>
                            <td>${req.data[i].vname}</td>
                            <td>${req.data[i].lname}</td>
                            <td>${req.data[i].pwd}</td>
                            <td>${req.data[i].tRole_id}</td>
                            <td>${req.data[i].count}</td>
                            <td>${req.data[i].ctime}</td>
                        </tr>`)
            }

        }
        $(`#${obj.el} table`).html(arr.join(''))
    }
    //分页链接
    var create_page = function (req, obj) {
        arr = ['<div></div><ul class="pagination">']
        if (req.current > 1) {
            str1 = `<li>
                    <a href="#" aria-label="Previous" onclick="set_page(${req.current - 1},temp.el,-4)">
                        <span aria-hidden="true">上一页</span>
                    </a>
                </li>`
        } else {
            str1 = `<li>
                    <a class="activ" href="#" aria-label="Previous" >
                        <span aria-hidden="true">上一页</span>
                    </a>
                </li>`
        }
        arr.push(str1)
        for (var a = 0; a < req.pages; a++) {
            if (req.current == a + 1) {
                arr.push(`<li><a class="activ" >${a + 1}</a></li>`)
            } else {
                arr.push(`<li><a  href="#"  onclick="set_page(${a + 1},'user',0)">${a + 1}</a></li>`)
            }
        }
        if (req.current < req.pages) {
            str2 = `<li>
                        <a href="#" aria-label="Previous"  onclick="set_page(${req.current + 1},temp.el,1)">
                            <span aria-hidden="true">下一页</span>
                        </a>
                    </li></ul>`
        } else {
            str2 = `<li>
                        <a  class="activ" href="#" aria-label="Previous" page="${req.current - 1}">
                           <span aria-hidden="true">下一页</span>
                        </a>
                    </li></ul>`
        }
        arr.push(str2)
        $(`#${obj.el} .bcard-foot`).html(arr.join(''))

    }
    //设置分页
    var set_page = function (page, obj, type = 0) {
        obj = temp
        if (type == 1) {
            obj.page += 1
        } else if (type == -1) {
            obj.page - 1
        } else {
            obj.page = page
        }

        get_lists(obj)
    }
    //点击事件
    var click_hanlde = function () {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var target = $(e.target).attr('href').substr(1)
            $("#" + target).show();
            var relatedTarget = $(e.relatedTarget).attr('href').substr(1)
            $("#" + relatedTarget).hide();
        })
        $('#users .add').on('click', function () {
            console.log(111111111111)
            $.ajax({
                url: '127.0.0.1:8000/v1/users/role',
                type: 'get',
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                async: false,
                success: function (req) {
                    console.log(req)
                    // if (req.code == '200') {
                    //     console.log(11)
                    // } else {
                    //     alert(req.error)
                    // }
                }
            })

        })

        $("#users .del").on("click", function () {
            del_itme(user)
        })
    }

    //添加
    var add_itme = function (obj) {
        $.ajax({
            url: obj.url,
            type: 'post',
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({'vname': vname, 'lname': lname, 'pwd': pwd}),
            success: function (req) {
                if (req.code == '200') {
                    get_lists(obj)
                } else {
                    alert(req.error)
                    return
                }
            },
            error: function (q, w, e) {
                console.log(q, w, e)
            }
        })

    }
    //修改
    var upd_itme = function () {

    }
    //删除
    var del_itme = function (obj) {
        ids = get_checked(obj.el)
        if (ids.length == 0) {
            alert('请选择删除项')
            return false
        }
        $.ajax({
            url: obj.url,
            type: 'delete',
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({'uids': ids}),
            success: function (req) {
                if (req.code == '200') {
                    alert('删除成功')
                    get_lists(obj)
                } else {
                    alert(req.error)
                }
            },
            error: function (q, w, e) {
                console.log(q, w, e)
            }
        })
    }

    //获取选中
    var get_checked = function (el) {
        arr = []
        var checkId = $(`#${el} input[name='favorite']:checked`)
        for (var a = 0; a < checkId.length; a++) {
            arr.push(checkId[a].value)
        }
        return arr
    }


    var create_select = function () {

    }
</script>
</body>
</html>







